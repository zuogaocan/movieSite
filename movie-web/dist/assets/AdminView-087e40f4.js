import{r,y as z,o as R,b as n,c as d,d as e,t as i,F as q,i as W,w as y,v as B,z as u,p,A as Z,B as M,q as x}from"./index-8b551f78.js";import{s as m}from"./index-6bb078dc.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";const H={class:"admin-container"},J={key:0,class:"loading-container"},K={key:1,class:"error-container"},Q={class:"error-message"},X={key:2,class:"empty-container"},Y={key:3,class:"site-list"},ee={class:"site-header"},se={class:"site-actions"},te=["onClick"],ae=["onClick"],le=["onClick","disabled"],ie={class:"site-details"},oe={class:"site-detail"},ne={class:"detail-value"},de={class:"site-detail"},re={class:"detail-value"},ce={class:"site-detail"},ue={class:"detail-value"},ve={class:"site-detail"},pe={class:"detail-value"},me={class:"modal-header"},fe={class:"modal-title"},be={class:"modal-body"},ye={class:"form-group"},_e=["disabled"],ge={key:0,class:"error-text"},ke={class:"form-group"},he={key:0,class:"error-text"},Ue={class:"form-group"},Ce={class:"input-group"},Be={key:0,class:"error-text"},we={class:"form-group"},Se={class:"form-group"},Ae={class:"checkbox"},xe={class:"modal-footer"},De=["disabled"],Ve={class:"modal-body"},Ie={class:"modal-footer"},ze=["disabled"],Me={__name:"AdminView",setup(Fe){const w=r([]),S=r(!0),_=r(""),g=r(!1),f=r(!1),k=r(!1),c=r(null),o=z({}),h=r(!1),v=r(null),U=r(!1),a=z({id:"",name:"",apiBaseUrl:"",playerUrl:"",active:!0}),b=async()=>{S.value=!0,_.value="";try{const t=await m.getAllSites();w.value=t}catch(t){console.error("加载站点失败:",t),_.value="加载站点列表失败，请稍后重试"}finally{S.value=!1}},D=()=>{f.value=!1,P(),g.value=!0},F=t=>{f.value=!0,Object.keys(a).forEach(s=>{s in t&&(a[s]=t[s])}),g.value=!0},C=()=>{g.value=!1,c.value=null,o.value={}},P=()=>{Object.keys(a).forEach(t=>{a[t]=t==="active"?!0:""}),c.value=null,o.value={}},T=async()=>{if(!a.apiBaseUrl){c.value={valid:!1,message:"请输入API地址再测试"};return}try{const t=await m.testSiteApi(a.apiBaseUrl);c.value=t}catch(t){c.value={valid:!1,message:"测试失败: "+(t.message||"未知错误")}}},E=()=>{const t={};return a.id?/^[a-zA-Z0-9_-]+$/.test(a.id)||(t.id="站点ID只能包含字母、数字、下划线和连字符"):t.id="站点ID不能为空",a.name||(t.name="站点名称不能为空"),a.apiBaseUrl?a.apiBaseUrl.startsWith("http")||(t.apiBaseUrl="API地址必须以http或https开头"):t.apiBaseUrl="API地址不能为空",o.id=t.id||"",o.name=t.name||"",o.apiBaseUrl=t.apiBaseUrl||"",Object.keys(t).length===0},N=async()=>{if(E()){k.value=!0;try{f.value?await m.updateSite(a.id,{name:a.name,apiBaseUrl:a.apiBaseUrl,playerUrl:a.playerUrl,active:a.active}):await m.addSite(a),await b(),C()}catch(t){console.error("保存站点失败:",t),alert("保存站点失败: "+(t.message||"未知错误"))}finally{k.value=!1}}},$=async t=>{try{await m.updateSiteStatus(t.id,!t.active),await b()}catch(s){console.error("更新站点状态失败:",s),alert("更新站点状态失败: "+(s.message||"未知错误"))}},j=t=>{if(t.id==="default"){alert("默认站点不能删除");return}v.value=t,h.value=!0},A=()=>{h.value=!1,v.value=null},L=async()=>{if(v.value){U.value=!0;try{await m.deleteSite(v.value.id),await b(),h.value=!1,v.value=null}catch(t){console.error("删除站点失败:",t),alert("删除站点失败: "+(t.message||"未知错误"))}finally{U.value=!1}}},O=t=>{try{return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return t||"未知"}};return R(()=>{b()}),(t,s)=>{var V;return n(),d("div",H,[s[23]||(s[23]=e("h1",{class:"admin-title"},"站点管理",-1)),e("div",{class:"admin-actions"},[e("button",{class:"btn btn-primary",onClick:D},"添加新站点")]),S.value?(n(),d("div",J,s[7]||(s[7]=[e("div",{class:"loading-spinner"},null,-1),e("div",{class:"loading-text"},"加载中...",-1)]))):_.value?(n(),d("div",K,[e("div",Q,i(_.value),1),e("button",{class:"btn btn-primary",onClick:b},"重试")])):w.value.length===0?(n(),d("div",X,[s[8]||(s[8]=e("div",{class:"empty-message"},"没有可用的站点配置",-1)),e("button",{class:"btn btn-primary",onClick:D},"添加站点")])):(n(),d("div",Y,[(n(!0),d(q,null,W(w.value,l=>(n(),d("div",{key:l.id,class:"site-card"},[e("div",ee,[e("div",{class:u(["site-name",{inactive:!l.active}])},[e("span",{class:u(["site-badge",{active:l.active}])},null,2),x(" "+i(l.name),1)],2),e("div",se,[e("button",{class:u(["btn btn-sm",l.active?"btn-warning":"btn-success"]),onClick:I=>$(l)},i(l.active?"禁用":"激活"),11,te),e("button",{class:"btn btn-sm btn-info",onClick:I=>F(l)},"编辑",8,ae),e("button",{class:"btn btn-sm btn-danger",onClick:I=>j(l),disabled:l.id==="default"},"删除",8,le)])]),e("div",ie,[e("div",oe,[s[9]||(s[9]=e("span",{class:"detail-label"},"站点ID:",-1)),e("span",ne,i(l.id),1)]),e("div",de,[s[10]||(s[10]=e("span",{class:"detail-label"},"API地址:",-1)),e("span",re,i(l.apiBaseUrl),1)]),e("div",ce,[s[11]||(s[11]=e("span",{class:"detail-label"},"播放器接口:",-1)),e("span",ue,i(l.playerUrl),1)]),e("div",ve,[s[12]||(s[12]=e("span",{class:"detail-label"},"添加时间:",-1)),e("span",pe,i(O(l.addTime)),1)])])]))),128))])),g.value?(n(),d("div",{key:4,class:"modal-overlay",onClick:C},[e("div",{class:"modal-container",onClick:s[5]||(s[5]=M(()=>{},["stop"]))},[e("div",me,[e("h2",fe,i(f.value?"编辑站点":"添加新站点"),1),e("button",{class:"modal-close",onClick:C},"×")]),e("div",be,[e("div",ye,[s[13]||(s[13]=e("label",{for:"site-id"},"站点ID *",-1)),y(e("input",{id:"site-id","onUpdate:modelValue":s[0]||(s[0]=l=>a.id=l),class:u(["form-control",{invalid:o.id}]),disabled:f.value,placeholder:"英文字符和数字，如 ffzy"},null,10,_e),[[B,a.id]]),o.id?(n(),d("div",ge,i(o.id),1)):p("",!0)]),e("div",ke,[s[14]||(s[14]=e("label",{for:"site-name"},"站点名称 *",-1)),y(e("input",{id:"site-name","onUpdate:modelValue":s[1]||(s[1]=l=>a.name=l),class:u(["form-control",{invalid:o.name}]),placeholder:"如 非凡资源站"},null,2),[[B,a.name]]),o.name?(n(),d("div",he,i(o.name),1)):p("",!0)]),e("div",Ue,[s[15]||(s[15]=e("label",{for:"site-api"},"API地址 *",-1)),e("div",Ce,[y(e("input",{id:"site-api","onUpdate:modelValue":s[2]||(s[2]=l=>a.apiBaseUrl=l),class:u(["form-control",{invalid:o.apiBaseUrl}]),placeholder:"如 http://ffzy5.tv/api.php/provide/vod"},null,2),[[B,a.apiBaseUrl]]),e("button",{class:"btn btn-secondary",onClick:T},"测试")]),o.apiBaseUrl?(n(),d("div",Be,i(o.apiBaseUrl),1)):p("",!0),c.value?(n(),d("div",{key:1,class:u(["api-test-result",{success:c.value.valid,error:!c.value.valid}])},i(c.value.message),3)):p("",!0)]),e("div",we,[s[16]||(s[16]=e("label",{for:"site-player"},"播放器接口",-1)),y(e("input",{id:"site-player","onUpdate:modelValue":s[3]||(s[3]=l=>a.playerUrl=l),class:"form-control",placeholder:"如 https://svip.ffzyplay.com/?url="},null,512),[[B,a.playerUrl]]),s[17]||(s[17]=e("div",{class:"form-hint"},"播放器接口用于解析视频地址，格式通常为 URL前缀?url=",-1))]),e("div",Se,[e("div",Ae,[y(e("input",{id:"site-active",type:"checkbox","onUpdate:modelValue":s[4]||(s[4]=l=>a.active=l)},null,512),[[Z,a.active]]),s[18]||(s[18]=e("label",{for:"site-active"},"站点激活",-1))]),s[19]||(s[19]=e("div",{class:"form-hint"},"只有激活的站点才会出现在搜索选项中",-1))])]),e("div",xe,[e("button",{class:"btn btn-secondary",onClick:C},"取消"),e("button",{class:"btn btn-primary",onClick:N,disabled:k.value},i(k.value?"保存中...":"保存"),9,De)])])])):p("",!0),h.value?(n(),d("div",{key:5,class:"modal-overlay",onClick:A},[e("div",{class:"modal-container confirm-modal",onClick:s[6]||(s[6]=M(()=>{},["stop"]))},[e("div",{class:"modal-header"},[s[20]||(s[20]=e("h2",{class:"modal-title"},"确认删除",-1)),e("button",{class:"modal-close",onClick:A},"×")]),e("div",Ve,[e("p",null,[s[21]||(s[21]=x("确定要删除站点 ")),e("strong",null,i((V=v.value)==null?void 0:V.name),1),s[22]||(s[22]=x(" 吗？此操作不可恢复。"))])]),e("div",Ie,[e("button",{class:"btn btn-secondary",onClick:A},"取消"),e("button",{class:"btn btn-danger",onClick:L,disabled:U.value},i(U.value?"删除中...":"删除"),9,ze)])])])):p("",!0)])}}},Ne=G(Me,[["__scopeId","data-v-ecd17ba2"]]);export{Ne as default};
