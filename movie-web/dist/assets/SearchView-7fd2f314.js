import{k as H,u as j,l as L,r as i,m as b,o as X,n as _,a as E,b as s,c as n,d as g,t as C,f as v,g as p,F as N,i as y,p as D,E as q,j as $,q as F}from"./index-8b551f78.js";import{s as ee,m as W}from"./index-6bb078dc.js";import{_ as te}from"./_plugin-vue_export-helper-c27b6911.js";const ae={class:"search-container"},oe={class:"search-header"},le={class:"search-title"},se={class:"site-selector"},ie={key:0,class:"loading-container"},ne={key:1,class:"error-container"},ce={key:2,class:"empty-container"},re={key:3,class:"movie-grid"},ue=["onClick"],ge={class:"movie-poster"},Ae=["src","alt"],Ie={class:"movie-info"},ve={class:"movie-title"},de={class:"movie-meta"},Ee={key:0,class:"meta-item"},he={key:1,class:"meta-item"},me={key:4,class:"pagination-container"},k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFGmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNi4wLWMwMDYgNzkuZGFiYWNiYiwgMjAyMS8wNC8xNC0wMDozOTo0NCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjQgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wNi0xOVQxMTowMTowOSswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDYtMTlUMTE6MDU6MzUrMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDYtMTlUMTE6MDU6MzUrMDg6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ZjM3NDU3ZTUtNDdmZS1m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",Ge={__name:"SearchView",setup(Be){const R=H(),S=j(),c=L(()=>R.query.keyword||""),A=L(()=>R.query.source||""),r=i([]),M=i(!1),J=i(!1),h=i(""),d=i(1),Z=i(24),Q=i(0),I=i([]),o=i("default"),m=i({}),U=async()=>{try{const t=await ee.getAllSites();return console.log("站点API返回数据:",t),I.value=[],t&&Array.isArray(t)?(I.value=t.filter(e=>e.active===!0),console.log("过滤后的可用站点:",I.value),A.value?o.value=A.value:(!o.value||o.value==="default")&&I.value.length>0&&(o.value=I.value[0].id),console.log("当前选中站点ID:",o.value)):console.error("站点数据格式错误:",t),!0}catch(t){return console.error("加载站点列表失败:",t),!1}},G=i(null),z=async()=>{if(!c.value)return;m.value={};const t=I.value.map(async e=>{try{const l={page:1,pageSize:1,source:e.id},u=await W.search(c.value,l);u&&typeof u.total=="number"&&(m.value[e.id]=u.total)}catch(l){console.error(`获取站点 ${e.name} 的结果数量失败:`,l),m.value[e.id]=0}});await Promise.all(t)},B=async()=>{if(c.value){M.value=!0,h.value="",J.value=!1,console.log("开始搜索，使用站点:",o.value);try{const t={page:d.value,pageSize:Z.value,source:o.value};console.log("搜索参数:",t);const e=await W.search(c.value,t);console.log("搜索结果:",e),e.list?(r.value=e.list,Q.value=e.total||0):(r.value=Array.isArray(e)?e:[],Q.value=r.value.length),r.value.length===0&&(h.value="未找到相关影片"),await z()}catch(t){console.error("搜索失败:",t),h.value="搜索失败，请稍后重试",q.error("搜索失败")}finally{M.value=!1}}},x=t=>{console.log("图片加载错误，使用占位图:",t.target.src);const e=t.target.alt||"未知电影";t.target.src!==k?t.target.src=k:t.target.src=`https://placehold.co/300x450/2c3e50/ffffff/png?text=${encodeURIComponent(e)}`},K=t=>{S.push({name:"detail",params:{id:t},query:{source:o.value}})},O=t=>{d.value=t,B()},f=()=>{console.log("站点切换，当前选择:",o.value),d.value=1,B(),S.push({name:"search",query:{keyword:c.value,source:o.value}})};b(()=>c.value,(t,e)=>{t!==e&&(d.value=1,B())}),X(()=>{U().then(()=>{console.log("站点加载完成，当前选中站点:",o.value),console.log("URL中的站点参数:",A.value),A.value&&A.value!==o.value&&(console.log("使用URL中的站点参数:",A.value),o.value=A.value),G.value=new IntersectionObserver(t=>{t.forEach(e=>{if(e.isIntersecting){const l=e.target,u=l.getAttribute("data-src");u&&(l.src=u,l.removeAttribute("data-src"),G.value.unobserve(l))}})},{rootMargin:"0px",threshold:.1}),c.value&&(console.log("开始执行搜索，使用站点:",o.value),B())})}),_(()=>{G.value&&G.value.disconnect()});const P=()=>{setTimeout(()=>{document.querySelectorAll(".lazy-load").forEach(e=>{var l;(l=G.value)==null||l.observe(e)})},100)};return b(()=>r.value,()=>{P()},{deep:!0}),(t,e)=>{const l=E("el-option"),u=E("el-select"),V=E("el-skeleton"),Y=E("el-button"),w=E("el-empty"),T=E("el-pagination");return s(),n("div",ae,[g("div",oe,[g("h1",le,"搜索结果: "+C(c.value),1),g("div",se,[v(u,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),placeholder:"选择资源站",onChange:f},{default:p(()=>[(s(!0),n(N,null,y(I.value,a=>(s(),$(l,{key:a.id,label:`${a.name}${m.value[a.id]?" ("+m.value[a.id]+")":""}`,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),M.value?(s(),n("div",ie,[v(V,{rows:10,animated:""})])):h.value?(s(),n("div",ne,[v(w,{description:h.value},{default:p(()=>[v(Y,{onClick:B,type:"primary"},{default:p(()=>e[3]||(e[3]=[F("重试")])),_:1})]),_:1},8,["description"])])):r.value.length===0?(s(),n("div",ce,[v(w,{description:"未找到相关影片"},{default:p(()=>[v(Y,{onClick:e[1]||(e[1]=a=>t.$router.push("/")),type:"primary"},{default:p(()=>e[4]||(e[4]=[F("返回首页")])),_:1})]),_:1})])):(s(),n("div",re,[(s(!0),n(N,null,y(r.value,a=>(s(),n("div",{key:a.id,class:"movie-card",onClick:pe=>K(a.id)},[g("div",ge,[g("img",{src:a.coverImage||k,alt:a.name,class:"poster-img",onError:x},null,40,Ae)]),g("div",Ie,[g("h3",ve,C(a.name),1),g("div",de,[a.year?(s(),n("span",Ee,C(a.year),1)):D("",!0),a.director?(s(),n("span",he,"导演: "+C(a.director),1)):D("",!0)])])],8,ue))),128))])),r.value.length>0?(s(),n("div",me,[v(T,{"current-page":d.value,"onUpdate:currentPage":e[2]||(e[2]=a=>d.value=a),"page-size":Z.value,layout:"prev, pager, next",total:Q.value,onCurrentChange:O},null,8,["current-page","page-size","total"])])):D("",!0)])}}},De=te(Ge,[["__scopeId","data-v-e476f1a1"]]);export{De as default};
